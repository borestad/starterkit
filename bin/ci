#!/bin/bash -eEu

. `dirname $0`/_helpers

cd "$(dirname $0)"

function finish {
  echo $? >&2
  git status
  git diff
  failure
}

trap finish EXIT


hr && \
yarn && \
hr && \
yarn lint && \
hr && \
yarn test --coverage --ci && \
hr && \
lerna run build --stream && \
#git status && \
#git diff && \
# Jenkins overwrites .npmrc
git checkout $ROOT/.npmrc && \
hr && \
./publish
#lerna publish --preid alpha -y --registry=$ARTIFACTORY_NPM_REGISTRY
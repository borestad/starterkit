#!/bin/bash
set +x -eEu
export PATH="./node_modules/.bin:$PATH"

. `dirname $0`/_helpers

cd $ROOT

trap trap-exit EXIT
trap trap-error INT TERM

line 'Cleanup'
yarn clean

line '|1/6] Install'
yarn

line '[2/6] Lint'
yarn lint

line '[3/6] Compile'
yarn compile

line '[4/6] Run tests'
yarn test --coverage --ci

line '[5/6] Build packages'
yarn build

line '[6/6] Publish packages (if version is bumped)'
$ROOT/bin/publish

line
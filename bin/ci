#!/bin/bash
set +x -eEu
export PATH="./node_modules/.bin:$PATH"

. `dirname $0`/_helpers

cd $ROOT

trap trap-exit EXIT
trap trap-error INT TERM

line '[1/8] Cleanup'
yarn clean

line '[2/8] Install'
yarn

line '[3/8] Show Environment'
$ROOT/node_modules/.bin/envinfo

line '[4/8] Lint'
yarn lint

line '[5/8] Compile'
yarn compile

line '[6/8] Run tests'
yarn test --coverage --ci

line '[7/8] Build packages'
yarn build

line '[8/8] Publish packages (if version is bumped)'
$ROOT/bin/publish

line
#!/bin/bash
set +x -eEu
export PATH="./node_modules/.bin:$PATH"

. `dirname $0`/_helpers

cd $ROOT

trap trap-exit EXIT
trap trap-error INT TERM

line '|1/5] Yarn install'
yarn

line '[2/5] Lint'
yarn lint

line '[3/5] Run tests'
yarn test --coverage --ci

line '[4/5] Build packages'
lerna run build --stream

line '[5/5] Publish packages if new version is available'
$ROOT/bin/publish